# Codex運用ガイド

## 目的
- 本リポジトリは、GSAPやWebGLで制作したモーションスタディを収蔵するNext.jsアプリ **Webimation Library** を管理します。
- Codexとして作業する際の基本ルールと手順を、このドキュメントで確認してください。

## 着手前に行うこと
1. 本ファイルと `docs/specification.md` を必ず通読する。
2. 対象ファイル内のTODOや注意コメントがないか確認する。
3. `git status -sb` を実行し、作業ツリーの状態を把握する。

## 開発環境
- パッケージマネージャー: `npm`
- 主なスクリプト:
  - `npm run dev` – 開発サーバー（Turbopack）
  - `npm run build` – 本番ビルド（Turbopack）
  - `npm run lint` – Lintチェック（完了前に必須）
- 主要依存関係: GSAP, React Three Fiber, Drei, React Syntax Highlighter など。詳細は `package.json` を参照。

## コーディング指針
- 既存の **TypeScript + React** 構成に従い、App Routerのパターンを崩さない。
- プレビュー用コンポーネントは宣言的に実装し、`src/animations/<slug>/` 配下にまとめる。
- UI文言・コメント・ドキュメントは日本語で記載する。
- アクセシビリティを意識し、対話要素にはキーボード操作とラベルを用意する。
- コンポーネントは責務ごとに小さく保ち、`variant` や `className` など既存のプロップを活用する。

## ディレクトリ構成のルール
- `src/animations/` – アニメーションごとのフォルダ。プレビューと `AnimationDefinition` を配置。
- `src/animations/index.ts` – アニメーション一覧と検索ヘルパー。追加時はここを更新。
- `src/components/` – ギャラリーやタブなどの共有UI。
- `src/app/` – レイアウトとページ。トップ、`[slug]` 詳細ページはこちら。
- `public/` – 画像やアイコンなどの静的アセット。

## アニメーション追加手順
1. 既存のフォルダを複製するか、新規に `src/animations/<slug>/` を作成。
2. プレビューコンポーネントとメタデータ（`slug`, `title`, `frameworks`, `sourceFiles` など）を更新。
3. 参照ファイルが複数ある場合は `sourceFiles` に全て列挙し、詳細画面のタブで参照できるようにする。
4. ギャラリーのモーダルと詳細ページで正しく動作するか動作確認を行う。

## テストと検証
- 作業完了前に必ず `npm run lint` を実行する。
- ランタイムの挙動に影響する変更を加えた場合は、可能な範囲で手動確認や追加テストを検討する。
- 実施できなかった検証は最終報告で明記し、次のアクションを提案する。

## コミュニケーション
- 変更内容を説明する際は「何を」「どこで」「なぜ」行ったかを簡潔に整理する。
- 既知のリスクや追加タスクがあれば必ず記載する。
- ファイル参照はリポジトリルートからのパスと `:行番号` を用いる。

## 判断に迷ったら
- 指示が矛盾する場合は優先度の高いもの（system > developer > user > 本ガイド）の順に従う。
- 不明点があれば独断で進めず、可能な範囲で確認する。

創造と実験を楽しんでください！
