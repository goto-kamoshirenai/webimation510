# Codex運用ガイド

## プロジェクト概要
- 本リポジトリは Next.js 15 + React で構築された **webimation510** を管理します。
- GSAP や WebGL を使った自作アニメーションをギャラリー化し、詳細ページでソースコードを閲覧できます。
- このドキュメントと `docs/specification.md` を常に参照しながら作業してください。

## 着手前の確認
1. `git status -sb` で作業ツリーを把握する。
2. 変更対象のファイルに TODO / 注意書きがないか確認する。
3. 仕様の差分がないか `docs/specification.md` も確認する。

## 開発環境と主要スクリプト
- パッケージマネージャー: `npm`
- `npm run dev` – 開発サーバー（Turbopack）
- `npm run lint` – ESLint（完了前に必須）
- `npm run build` / `npm run start` – 本番ビルドと起動

## コーディング指針
- 既存の TypeScript + React の構成（App Router）に準拠する。
- UI・コメント・ドキュメントはすべて日本語で記載する。
- `src/animations/<slug>/` 配下にプレビューと定義をまとめ、派生は親ディレクトリ内のサブフォルダに配置する（例: `liquid-ribbon/aurora`）。
- `AnimationDefinition` には `parentSlug` が追加済み。派生アニメーションを作る場合は親の `slug` を指定する。
- 新しい UI を追加する際はアクセシビリティ（キーボード操作、aria属性）を意識する。
- 既存のスタイルユーティリティ（Tailwind）と `variant` プロップによる高さ切り替えを踏襲する。

## ディレクトリ概要
- `src/animations/` – アニメーションごとのフォルダ。Liquid Ribbon 系の派生は `liquid-ribbon/` 以下にサブフォルダで管理。
- `src/components/GalleryGrid.tsx` – トップのギャラリーとモーダル。親アニメーションのみ一覧表示。
- `src/components/HeaderNav.tsx` – 固定ヘッダーのナビゲーション（クリックで開閉するドキュメントメニュー）。
- `src/components/SourceTabs.tsx` – ソースコードタブ表示。
- `src/app/animations/[slug]/page.tsx` – 詳細ページ。親リンク・派生カード表示のロジックを含む。

## アニメーション追加手順
1. `src/animations/<slug>/`（派生は親ディレクトリ内のサブフォルダ）にプレビューコンポーネントと `index.ts` を作成する。
2. `AnimationDefinition` の `slug` / `title` / `frameworks` / `createdAt` / `sourceFiles` を設定し、派生であれば `parentSlug` を指定する。
3. `sourceFiles` には詳細ページで公開するファイルのリポジトリ相対パスをすべて列挙する。
4. `src/animations/index.ts` に定義を追加し、必要に応じて並び順を調整する。
5. ギャラリー（親のみ表示）と詳細ページ、派生カードのモーダルを実機で確認する。
6. `npm run lint` を実行してから作業を終了する。

## 品質とテスト
- `npm run lint` は必ず実行し、警告も可能な限り解消する。
- ランタイム挙動を変える変更は `npm run dev` での動作確認を推奨し、行えない場合は最終メッセージで共有する。
- 追加の自動テストが必要になった場合は `__tests__/` を新設することを検討する。

## レポート時の注意
- 「何を」「どこで」「なぜ」行ったのかを簡潔にまとめる。
- 未実施の検証や懸念点は明示する。
- ファイル参照は `path/to/file.tsx:12` の形式で記載する。

## 指示の優先順位
system > developer > user > このガイドの順で従う。判断に迷った場合は安全側で対応する。

以上を守り、安心してモーション研究を進めてください。
## コミットメッセージルール
- 参考: [Gitのコミットメッセージの書き方（ライト版）](https://qiita.com/itosho/items/9565c6ad2ffc24c09364)
- フォーマットは `種類: 内容`（半角コロン）で1行目を記述する。
- 種類は次の4つのみを使用する。
  - `add`: 機能追加 / 新規ファイル追加
  - `fix`: バグ修正
  - `update`: リファクタリング・仕様追加など、破壊的でない変更
  - `remove`: ファイル削除や機能撤廃
- 2行目以降に詳細を書く場合は空行を挟んで箇条書きで補足する。
- コミットは意味単位でまとめ、小さな変更でも上記ルールに従う。
## 回答時のマークルール
- このドキュメントの参照確認のため、AI は最終回答の末尾に必ず `<!-- checked -->` を付与する。
- 回答本文と同じ行、もしくは末尾の新しい行にマークを入れる。
- マークはそのまま提出し、必要に応じて利用者が削除できるようにする。
